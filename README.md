# IOTdeviceSim (IoT Device Simulator)

A lightweight **FastAPI** application that simulates IoT devices and exposes REST APIs for device management and command handling.  
The project includes an **async pytest** test suite with automatic HTML and JUnit reporting, and a **Docker Compose** setup with Redis.

---

## Tech Stack

- Python 3.11
- FastAPI
- Redis
- Pytest + pytest-asyncio
- Docker & Docker Compose

---

## Project Structure (based on this repository)

- `src/app.py` — FastAPI application entrypoint
- `src/config.py` — configuration 
- `src/dependencies.py` — shared dependencies
- `src/models.py` — Pydantic models / schemas
- `src/utils.py` — helper utilities 
- `src/test_devices.json` — sample devices data used for seeding
- `src/tests/` — automated pytest suite
- `docker-compose.yml` — runs `app` + `redis`
- `dockerfile` — application container definition
- `pytest.ini` — pytest configuration and reporting
- `reports/` — test reports

---

## Running the application

### Option A: Run with Docker Compose (recommended)

```bash
docker compose up --build
```

Application will be available at:
- API: http://localhost:8008
- Swagger UI: http://localhost:8008/docs
- ReDoc: http://localhost:8008/redoc

Stop services:
```bash
docker compose down
```

**Redis connection in Docker**
- `REDIS_HOST=redis`
- `REDIS_PORT=6379`

---

### Option B: Run locally (without Docker)

```bash
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
uvicorn src.app:app --reload --host 0.0.0.0 --port 8008
```

If you run Redis locally, use:
- `REDIS_HOST=localhost`
- `REDIS_PORT=6379`

---

## Running the tests

Run all tests (reports are generated automatically via `pytest.ini`):

```bash
pytest
```

Reports:
- HTML: `reports/pytest_report.html`
- JUnit: `reports/junit.xml`

Run specific tests:
```bash
pytest src/tests/test_devices.py -vv
pytest src/tests/test_commands.py::test_command_publishes_event -vv
```

---

## Fixture design decisions

- **Async-first testing** using `asyncio_mode = auto` to support async FastAPI behavior.
- **API-level HTTP testing** to validate routing, request validation, response schemas, and Redis integration.
- **Redis-backed state isolation** (tests should control/clean state to remain deterministic).
- **Parametrized fixtures** where useful to cover valid/invalid/edge payloads clearly.

---

## Assumptions and design choices

- Redis is required for device/state storage.
- Docker Compose is the recommended setup for consistent execution.
- The application listens on port **8008**.
- Test reports are generated by default for easier debugging and CI usage.

---
